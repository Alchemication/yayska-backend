# Yayska Backend

## Development Setup

### 1. Environment Setup

First, create and activate a virtual environment:
```bash
python -m venv .venv
source .venv/bin/activate  # On Unix/macOS
# or
.venv\Scripts\activate  # On Windows
```

### 2. Install Dependencies

```bash
# Install uv package manager (recommended)
pip install uv

# Install project dependencies
uv pip install --editable ".[dev]"
```

### 3. Configure Environment Variables

Create a `.env` file in the project root:

```bash
# Database Configuration
POSTGRES_SERVER=localhost
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres  # Change in production
POSTGRES_DB=yayska
POSTGRES_PORT=5432
```

### 4. Database Setup

#### Start Local Database
```bash
# Start PostgreSQL container
docker compose up -d

# Verify container is running
docker compose ps
```

#### Database Management
```bash
# Stop and remove containers
docker compose down

# Stop and remove containers + delete volumes (clean slate)
docker compose down -v

# View database logs
docker compose logs -f db
```

#### Common Issues
- If port 5432 is already in use, modify the port mapping in `docker-compose.yml`
- Ensure Docker is running before executing compose commands
- For permission issues, try running commands with sudo (Linux/macOS)

## Database Migrations

### Migration Approaches

1. **Autogenerated Migrations** (Preferred)
```bash
alembic revision --autogenerate -m "description_of_changes"
```
Use when:
- Adding/modifying SQLAlchemy models
- Making schema changes that can be detected automatically
- Handling standard operations (create/alter table, add/remove columns)

2. **Raw SQL Migrations** (Special Cases)
```bash
alembic revision -m "raw_sql_changes"
```
Use when:
- Performing complex database operations
- Adding custom functions or triggers
- Making changes that can't be expressed through SQLAlchemy models
- Inserting metadata or custom mapping data

Example raw SQL migration:
```python
def upgrade() -> None:
    op.execute("""
        CREATE INDEX CONCURRENTLY idx_users_email ON users(email);
        -- Use for operations not supported by SQLAlchemy
    """)

def downgrade() -> None:
    op.execute("DROP INDEX IF EXISTS idx_users_email;")
```

### Managing Migrations

```bash
# Apply all pending migrations
alembic upgrade head

# Rollback migrations
alembic downgrade -1    # Revert last migration
alembic downgrade base  # Revert all migrations
```

> **Note**: Always review autogenerated migrations before applying them to ensure they capture your intended changes correctly.

## Start the server

```bash
uvicorn app.main:app --reload
```
